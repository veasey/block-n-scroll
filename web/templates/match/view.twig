{% extends "team/team_base.twig" %}

{% block title %}
    Block &amp; Scroll - Match - {{ match.homeTeam.name }} vs {{ match.awayTeam.name ?? match.away_team_name }}
{% endblock %}

{% block content %}

    <p class="breadcrumbs">
        <a href="/">Home</a> -
        <a href="/match/view/all">Matches</a> -
        <a href="/match/view/{{match.id}}">Match #{{match.id}}</a>
    </p>

    <h2>
        Match #{{match.id}}:
        {% include 'partials/home_team_name.twig' with {'match': match} %} vs 
        {% include 'partials/away_team_name.twig' with {'match': match} %}
    </h2>

    {% if match.homeTeam.status == 'playing' %}
        <h1>In Progress</h2>
    {% else %}
        {% include 'match/end/partials/match_result.twig' with {'match': match} %}
    {% endif %}

    {% if isAdmin or team %}
        <div class="team-quick-buttons" style="border: 1px solid gray; border-radius: 8px; padding: 0.5em;">
            <a href='/team/quick/{{ team.id }}/note' class="quick-btn" title="Add Note">üìù Note</a>
        </div>
    {% endif %}

    <table class="match-details">
        <tr>
            <th>Match Status</th>
            <td>{{ match.status }}</td>
        </tr>
        <tr>
            <th>Home Team</th>
            <td>{% include 'partials/home_team_name.twig' with {'match': match} %}</td>
        </tr>
        <tr>
            <th>Away Team</th>
            <td>{% include 'partials/away_team_name.twig' with {'match': match} %}</td>
        </tr>
        <tr>
            <th>Home Score</th>
            <td>{{ match.home_score }}</td>
        </tr>
        <tr>
            <th>Away Score</th>
            <td>{{ match.away_score }}</td>
        </tr>
        <tr>
            <th>League</th>
            <td>{{ match.league.name ?? '-' }}</td>
        </tr>
        <tr>
            <th>Match Start</th>
            <td>{{ match.created_at|date('Y/m/d H:i') }}</td>
        </tr>
        <tr>
            <th>Last Update</th>
            <td>
                {% if match.homeTeam.status != 'playing' %}
                    {{ match.updated_at|date('Y/m/d H:i') }}
                {% else %}
                    -
                {% endif %}
            </td>
        </tr>

        {% if match.status == 'finished' %}
            <th>Duration</th>
            <td>
                {% set duration = match.updated_at.diff(match.created_at) %}
                {% set total_minutes = duration.days * 1440 + duration.hours * 60 + duration.minutes %}

                {% if total_minutes < 2 %}
                    <strong>Suspiciously Short</strong>
                {% else %}
                    {% if duration.hours > 0 %}
                        {{ duration.hours }}h
                    {% endif %}
                    {{ duration.minutes }}m
                {% endif %}
            </td>
        {% endif %}
    </table>

    {% if logs|length == 0 %}
        <p><strong>No relevant logs written, yet.</strong></p>
    {% else %}
        <table id="positions-table">
            <thead>
                <tr>
                    <th>Time</th>
                    <th>Event Type</th>
                    <th>Event Info</th>
                    <th>Team</th>
                    <th>Player</th>
                    <th>Notes</th>
                </tr>
            </thead>
            <tbody>
                {% for log in logs %}
                    <tr>
                        <td>{{ log.created_at | date("m/d/Y h:i:s") }}</td>
                        <td>{{log.event_type}}</td>
                        <td>{{ log.event_value }} {{ log.event_key }}</td>
                        <td><a href="/team/view/{{log.team.id}}">{{ log.team.name }}</a></td>
                        <td>
                            {% if log.player.id %}
                                <a href="/player/view/{{log.player.id}}">{{ log.player.name }} (#{{ log.player.number }})</a>
                            {% endif %}
                        </td>
                        <td>{{ log.notes }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        {% if totalPages > 1 %}
            {% include 'partials/pagination.twig' with {'page': page, 'totalPages': totalPages} %}
        {% endif %}
    {% endif %}

    <p style="margin-top: 1.5em;">
        <a href="/match/view/all">‚Üê Back to all matches</a>
    </p>

{% endblock %}
